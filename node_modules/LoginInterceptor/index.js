var LoginInterceptor = function(settings){
    return function(req,res,next){
        var $NotInterceptUrl = settings.$NotInterceptUrl;
        var $IsLogin = settings.$IsLogin;
        var $$OnNotLogin = settings.$OnNotLogin;

        /* 已.html结尾，进行拦截 */
        var _Url = req.originalUrl;
        if(_Url.indexOf('?')!=-1){
            _Url = _Url.split('?')[0];
        }
        if(/^\/admin/.test(_Url)){
            next();
            return;
        }
        if(_Url.indexOf(".html")!=-1){
            for(var iIndex = 0;iIndex<$NotInterceptUrl.length;iIndex++){
                if(_Url== $NotInterceptUrl[iIndex]){
                    next();
                    return;
                }
            }

            if($IsLogin(req,res,next)){
                next();
                return;
            }

            $$OnNotLogin(req,res,next);
        }else{
            next();
        }

    }
};

module.exports = LoginInterceptor;